<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Easbroidery — Editor</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body class="site">
  <header class="nav">
    <a class="brand" href="index.html">
      <img src="assets/logo.png" alt="Easbroidery logo"/>
      <span>EASBROIDERY</span>
    </a>
    <nav class="links">
      <a href="index.html">Home</a>
      <a href="features.html">Features</a>
      <a href="pricing.html">Pricing</a>
    </nav>
  </header>

  <main class="wrap editor">

    <!-- Collapsible general options (hoop, machine) -->
    <details class="card opts" id="opts">
      <summary>General options (machine & hoop)</summary>
      <div class="row">
        <label>Machine
          <select id="machine">
            <option value="brother">Brother / Baby Lock</option>
            <option value="janome">Janome</option>
            <option value="bernina">Bernina</option>
            <option value="generic" selected>Generic</option>
          </select>
        </label>
        <label>Hoop size
          <select id="hoop">
            <option value="100x100">100 × 100 mm (4×4)</option>
            <option value="130x180" selected>130 × 180 mm (5×7)</option>
            <option value="160x260">160 × 260 mm (6×10)</option>
            <option value="200x300">200 × 300 mm (8×12)</option>
          </select>
        </label>
        <label>Stitch spacing
          <input id="spacing" type="number" min="0.5" step="0.1" value="1.2"> mm
        </label>
        <label>Angle
          <input id="angle" type="range" min="0" max="180" value="45">
          <span id="angleOut">45°</span>
        </label>
        <label><input id="dirOverlay" type="checkbox" checked> Show direction overlay</label>
      </div>
    </details>

    <!-- LEFT: upload + edit canvas + tools attached -->
    <section class="edit card">
      <h2>1. Upload & refine</h2>

      <div class="toolbar compact">
        <label class="file"><input type="file" id="file" accept="image/*">Choose File</label>
        <button class="btn ghost" id="auto">Auto highlight</button>
        <div class="zoom">
          <button class="btn ghost" id="zoomOut">−</button>
          <span id="zoomPct">100%</span>
          <button class="btn ghost" id="zoomIn">+</button>
          <span class="tip">Tip: Alt/Option+drag to pan while zoomed</span>
        </div>
      </div>

      <div class="canvas-wrap">
        <canvas id="editCanvas" width="1024" height="768" aria-label="Edit canvas"></canvas>
      </div>

      <!-- Attach Brush/Text/Direction directly under edit canvas -->
      <div class="tools">
        <div class="seg">
          <div class="seg-tabs">
            <button class="seg-btn active" data-tab="mask">Mask</button>
            <button class="seg-btn" data-tab="text">Text</button>
            <button class="seg-btn" data-tab="dir">Direction</button>
          </div>

          <!-- Mask tools -->
          <div class="seg-pane" id="pane-mask" data-pane>
            <label>Size <input id="brushSize" type="range" min="2" max="120" value="28"></label>
            <div class="chip-row">
              <button class="chip" id="toolPaint">Paint</button>
              <button class="chip" id="toolErase">Erase</button>
              <button class="chip" id="toolWand">Wand</button>
              <button class="chip" id="toolFill">Fill</button>
              <button class="chip" id="undo">Undo</button>
              <button class="chip" id="redo">Redo</button>
              <button class="chip" id="clear">Clear</button>
            </div>
            <label><input id="showMask" type="checkbox" checked> Show mask</label>
            <label><input id="showEdges" type="checkbox"> Show edges</label>
          </div>

          <!-- Text tools -->
          <div class="seg-pane hidden" id="pane-text" data-pane>
            <label>Text <input id="textStr" type="text" placeholder="Add text"></label>
            <div class="row">
              <label>Size <input id="textSize" type="range" min="8" max="160" value="64"></label>
              <label>Curve <input id="textCurve" type="range" min="-100" max="100" value="0"></label>
              <label>Angle <input id="textAngle" type="range" min="-180" max="180" value="0"></label>
            </div>
            <div class="row">
              <label>Font
                <select id="textFont">
                  <option value="Georgia,serif">Serif</option>
                  <option value="'Courier New',monospace">Mono</option>
                  <option value="'Comic Sans MS','Segoe UI',sans-serif" selected>Cute</option>
                </select>
              </label>
              <label>Color <input id="textColor" type="color" value="#333333"></label>
              <button class="btn" id="applyText">Apply</button>
            </div>
            <small>Drag text on the edit canvas to position.</small>
          </div>

          <!-- Direction tools -->
          <div class="seg-pane hidden" id="pane-dir" data-pane>
            <p>Brush directions set local stitch flow. Painting records arrows; the preview uses them when hatching.</p>
            <label>Arrow length <input id="dirLen" type="range" min="10" max="200" value="80"></label>
            <div class="chip-row">
              <button class="chip" id="toolDir">Direction brush</button>
              <button class="chip" id="clearDir">Clear directions</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- RIGHT: live preview in a machine hoop -->
    <section class="preview card">
      <h2>2. Live preview</h2>
      <div id="hoopWrap" class="hoop">
        <canvas id="previewCanvas" width="900" height="700" aria-label="Hoop preview"></canvas>
        <div class="hoop-hardware" aria-hidden="true"></div>
      </div>

      <!-- Palette selection after preview is created -->
      <div class="palette" id="palette" hidden>
        <h3>Colors</h3>
        <div id="swatches" class="swatches"></div>
        <div class="row">
          <label>Limit
            <input id="kColors" type="range" min="2" max="12" value="6">
            <span id="kOut">6</span>
          </label>
          <button class="btn ghost" id="recompute">Recompute</button>
        </div>
        <small>Click a swatch to toggle it on/off for stitches.</small>
      </div>
    </section>

  </main>

  <!-- Sticky action bar -->
  <div class="actionbar">
    <label><input id="showStitch" type="checkbox" checked> Show stitch preview</label>
    <button class="btn primary" id="make">Generate stitches</button>
    <button class="btn" id="dlPNG">PNG</button>
    <button class="btn" id="dlSVG">SVG</button>
    <button class="btn" id="dlJSON">Stitches JSON</button>
    <button class="btn" id="dlDST">DST</button>
  </div>

  <!-- Scripts (modular & organized) -->
  <script src="lib/ort.min.js"></script>
  <script src="colors.js"></script>
  <script src="processing.js"></script>
  <script src="script.upload.js"></script>
  <script src="script.draw.js"></script>
  <script src="script.preview.js"></script>
</body>
</html>