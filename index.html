<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Loomabelle — Image → Embroidery (.DST)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@700;900&family=Quicksand:wght@500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css"/>
</head>
<body>
  <header class="hero">
    <h1 class="stitched-title">Loomabelle</h1>
    <p class="subtitle">Turn simple art into embroidery — right in your browser.</p>
  </header>

  <main class="wrap">
    <section class="panel controls">
      <div class="tabs">
        <button class="tab active" data-tab="upload">Upload</button>
        <button class="tab" data-tab="draw">Draw</button>
      </div>

      <div class="tab-body active" id="tab-upload">
        <label class="file">
          <input type="file" id="fileInput" accept="image/png,image/jpeg,image/heic,image/heif" />
          <span>Choose image (JPG/PNG/HEIC)</span>
        </label>
      </div>

      <div class="tab-body" id="tab-draw">
        <canvas id="drawCanvas" width="600" height="400"></canvas>
        <div class="row">
          <button id="drawClear" class="btn">Clear</button>
          <label>Brush <input id="brushSize" type="range" min="2" max="32" value="8"></label>
        </div>
      </div>

      <div class="grid">
        <label>Machine preset
          <select id="preset">
            <option value="generic">Generic / Other</option>
            <option value="brother-se2000" selected>Brother SE2000 (5×7 default)</option>
          </select>
        </label>

        <label>Hoop
          <select id="hoop">
            <option value="100x100">4×4 (100×100mm)</option>
            <option value="130x180" selected>5×7 (130×180mm)</option>
            <option value="160x260">6×10 (160×260mm)</option>
            <option value="custom">Custom…</option>
          </select>
        </label>

        <label id="customHoopFields" class="row hidden">
          <span>W (mm) <input id="hoopW" type="number" min="40" max="400" value="130"></span>
          <span>H (mm) <input id="hoopH" type="number" min="40" max="400" value="180"></span>
        </label>

        <label>Colors (≤6)
          <input id="maxColors" type="number" min="2" max="6" value="4">
        </label>

        <label>Fill angle°
          <input id="fillAngle" type="number" min="0" max="180" value="45">
        </label>

        <label>Density (mm)
          <input id="density" type="number" step="0.05" min="0.25" max="1.5" value="0.40">
        </label>

        <label>Format
          <select id="format">
            <option value="dst" selected>DST (Tajima — works on Brother)</option>
          </select>
        </label>
      </div>

      <div class="toggles">
        <label class="toggle"><input id="autoColors" type="checkbox" checked> Auto colors</label>
        <label class="toggle"><input id="autoEmb" type="checkbox" checked> Auto embroider</label>
        <label class="toggle"><input id="removeBg" type="checkbox" checked> Remove background</label>
        <label class="toggle"><input id="outline" type="checkbox" checked> Outline (satin-ish)</label>
        <label class="toggle"><input id="refine" type="checkbox"> Refine subject (paint tools; v1.1)</label>
      </div>

      <div class="row actions">
        <button id="btnProcess" class="btn primary" disabled>Process</button>
        <button id="btnDownloadDST" class="btn" disabled>Download .DST</button>
        <button id="btnDownloadPalette" class="btn" disabled>Palette (.txt)</button>
        <button id="btnBrotherTips" class="btn">Brother tips</button>
      </div>

      <details class="notes">
        <summary>Notes</summary>
        <ul>
          <li>Best with logo-style art (3–6 colors).</li>
          <li>We add **Color Change** stops between color blocks. Your Brother will prompt you to change thread.</li>
          <li>Use **Custom hoop** for other frames (keep within your machine limits).</li>
        </ul>
      </details>

      <div class="log" id="log" role="log" aria-live="polite"></div>
    </section>

    <section class="panel preview">
      <h2 class="stitched">Preview (with hoop)</h2>
      <div class="hoop">
        <canvas id="preview" width="600" height="600" aria-label="Embroidery preview"></canvas>
        <p class="hint">Rounded rectangle = hoop bounds.</p>
      </div>
    </section>
  </main>

  <footer class="foot">
    <small>Made with ♥ — runs 100% in your browser.</small>
  </footer>

  <dialog id="brotherDialog">
    <h3>Brother SE2000 tips</h3>
    <ol>
      <li>Choose <b>5×7 (130×180mm)</b> hoop or set your custom size.</li>
      <li>Tap <b>Process</b> → <b>Download .DST</b>.</li>
      <li>Copy the file to USB (or import via Brother app).</li>
      <li>On the machine: import the DST. It will show separate color blocks/stops — assign your thread colors there.</li>
      <li>If the design is rotated/offset, use the machine’s rotate/move or re-export with a different fill angle.</li>
    </ol>
    <form method="dialog">
      <button class="btn primary">Got it</button>
    </form>
  </dialog>

  <script type="module" src="js/app.js"></script>
</body>
</html>